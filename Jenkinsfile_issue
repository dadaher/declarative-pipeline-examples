pipeline {
    agent any
    environment {
        GITHUB_TOKEN = credentials('fine-grained-token')
    }
    stages {

        stage('Push issue to Github') {
            steps {
                echo 'This is an example stage.'
                // Replace this with your actual build steps
                 sh '''
                curl -L \
                  -X POST \
                  -H "Accept: application/vnd.github+json" \
                  -H "Authorization: Bearer ${GITHUB_TOKEN_PSW}" \
                  https://api.github.com/repos/DTPaviation/tnexus-server/issues \
                  -d '{"title":"Test Issue Generated by jenkins","body":"Issue Generated by jenkins.","assignees":["dadaher"],"projects":["Internal Tnexus Builds and Deployments"],"labels":["internal_build"]}'
                '''
            }
        }
        stage('Push issue try 2') {
            steps {
                echo 'This is an example stage.'
                // Replace this with your actual build steps
                 sh '''
                curl -L \
                  -X POST \
                  -H "Accept: application/vnd.github+json" \
                  -H "Authorization: Bearer ${GITHUB_TOKEN_PSW}" \
                  https://api.github.com/repos/dadaher/declarative-pipeline-examples/issues \
                  -d '{"title":"Found a bug5","body":"Found a problem with this.","assignees":["dadaher"],"projects":["iterative development"],"labels":["development"]}'
                '''
            }
        }
    }
    post {
        success {
            script {
                // Define the details of the issue to be created
                def issueDetails = [
                    title: "Build Successful",
                    body: "The build for ${env.BUILD_ID} completed successfully.",
                    labels: ["build", "success"]
                ]

                // Construct the URL for creating an issue in the GitHub repository
                def apiUrl = "https://api.github.com/repos/dadaher/declarative-pipeline-examples/issues"

                // Use the 'sh' step to execute a shell command that makes a POST request to the GitHub API

            }
        }
    }
}
